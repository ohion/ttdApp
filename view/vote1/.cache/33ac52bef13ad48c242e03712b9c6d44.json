{"dependencies":[{"name":"./jquery-3.2.1.min.js","loc":{"line":1,"column":14}},{"name":"../../js/servers.js","loc":{"line":2,"column":20}},{"name":"./template.js","loc":{"line":3,"column":21}},{"name":"./main.js","loc":{"line":4,"column":49}},{"name":"../css/index.css","loc":{"line":5,"column":16}},{"name":"../toast/toast.js","loc":{"line":6,"column":20}},{"name":"../toast/toast.css","loc":{"line":7,"column":21}}],"generated":{"js":"\"use strict\";\n\nvar _jquery321Min = require(\"./jquery-3.2.1.min.js\");\n\nvar _jquery321Min2 = _interopRequireDefault(_jquery321Min);\n\nvar _servers = require(\"../../js/servers.js\");\n\nvar _servers2 = _interopRequireDefault(_servers);\n\nvar _template = require(\"./template.js\");\n\nvar _template2 = _interopRequireDefault(_template);\n\nvar _main = require(\"./main.js\");\n\nvar _index = require(\"../css/index.css\");\n\nvar _index2 = _interopRequireDefault(_index);\n\nvar _toast = require(\"../toast/toast.js\");\n\nvar _toast2 = _interopRequireDefault(_toast);\n\nvar _toast3 = require(\"../toast/toast.css\");\n\nvar _toast4 = _interopRequireDefault(_toast3);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\n// console.log(main);\n// console.log(servers);\n// console.log(getQueryString);\n/*function getQueryString(name) {\r\n    var reg = new RegExp(\"(^|&)\" + name + \"=([^&]*)(&|$)\", \"i\");\r\n    var r = window.location.search.substr(1).match(reg);\r\n    if (r != null)\r\n        return unescape(r[2]);\r\n    return null;\r\n}\r\n//写cookies\r\nfunction setCookie(name, value) {\r\n    var Days = 30;\r\n    var exp = new Date();\r\n    exp.setTime(exp.getTime() + Days * 24 * 60 * 60 * 1000);\r\n    document.cookie = name + \"=\" + escape(value) + \";expires=\" + exp.toGMTString();\r\n}\r\n//读取cookies\r\nfunction getCookie(name) {\r\n    var arr, reg = new RegExp(\"(^| )\" + name + \"=([^;]*)(;|$)\");\r\n    if (arr = document.cookie.match(reg))\r\n        return unescape(arr[2]);\r\n    else\r\n        return null;\r\n}*/\n\n// 获取url参数\nvar sOpenId = (0, _main.getQueryString)(\"sOpenId\");\nvar ua = navigator.userAgent.toLowerCase(); //获取判断用的对象\nif (ua.match(/MicroMessenger/i) == \"micromessenger\") {\n  //微信  u授权\n  sOpenId = (0, _main.getQueryString)(\"sOpenId\"); // 获取url sOpenId 参数\n  sAccessToken = (0, _main.getQueryString)(\"sAccessToken\"); // 获取url sAccessToken 参数\n}\nvar userid = (0, _main.getQueryString)(\"id\");\nvar lrefereeId = (0, _main.getQueryString)(\"lrefereeId\");\nvar refuserid = (0, _main.getQueryString)(\"refuserid\");\nvar url_param = window.location.search;\n//    控制字体大小\n(function (doc, win) {\n  var docEl = doc.documentElement,\n      retime,\n      resizeEvt = 'orientationchange' in window ? 'orientationchange' : 'resize',\n      recalc = function () {\n    var clientWidth = docEl.clientWidth;\n    if (!clientWidth) return;\n    docEl.style.fontSize = 100 * (clientWidth / 375) + 'px';\n  };\n  // Abort if browser does not support addEventListener\n  if (!doc.addEventListener) return;\n  win.addEventListener(resizeEvt, recalc, false);\n  doc.addEventListener('DOMContentLoaded', recalc, false);\n})(document, window);\n(0, _jquery321Min2.default)(function () {\n  // 获取列表\n  // 投票\n  var host = _servers2.default.voteService;\n  var page = 1;\n  render(page);\n  function render(page) {\n    var voteobj = {\n      userId: userid ? userid : 0,\n      page: page\n    };\n    _jquery321Min2.default.ajax({\n      url: \"http://\" + host + \"/vote/queryAssociation\",\n      type: \"post\",\n      data: voteobj,\n      success: function (res) {\n        res = JSON.parse(res);\n        if (res.state == 0) {\n          (0, _jquery321Min2.default)(\"#head\").attr(\"src\", res.result.photoUrl);\n          res.result.page = page;\n          var tpl = document.getElementById('tpl').innerHTML;\n          var newDom = document.createElement(\"div\");\n          newDom.innerHTML = (0, _template2.default)(tpl, { result: res.result });\n          document.getElementById('content').appendChild(newDom);\n          if (res.result.list.length == 0) {\n            (0, _jquery321Min2.default)(window).unbind('scroll', getmore); //解绑scroll事件\n            (0, _jquery321Min2.default)(\".tip\").text(\"到底咯\");\n          }\n        }\n      },\n      error: function (err) {\n        toast.tips('网络不顺畅，请稍后再试');\n      }\n    });\n  }\n\n  //下拉加载更多\n  // window.addEventListener(\"scroll\",getmore);\n  (0, _jquery321Min2.default)(window).scroll(getmore);\n  function getmore() {\n    var oscroll = (0, _jquery321Min2.default)(document).scrollTop() + (0, _jquery321Min2.default)(window).height();\n    if (oscroll > (0, _jquery321Min2.default)(\"#content\").height() + 150) {\n      render(++page);\n    }\n  }\n\n  (0, _jquery321Min2.default)(\"#content\").on(\"click\", \".vote\", function () {\n    var id = (0, _jquery321Min2.default)(this).data(\"id\");\n    var ele = (0, _jquery321Min2.default)(this);\n    // 跳到注册界面\n    if (!userid) {\n      window.location.href = \"http://\" + _servers2.default.shopServer + \"/appbs/vote/invite.html\" + url_param;\n    } else {\n      var obj = {\n        userId: userid,\n        id: id\n        // 投票\n      };_jquery321Min2.default.ajax({\n        url: \"http://\" + host + \"/vote/userVote\",\n        type: \"post\",\n        data: obj,\n        success: function (res) {\n          res = JSON.parse(res);\n          if (res.state == 0) {\n            toast.tips('投票成功');\n            //票数+1   按钮不可点击\n            var votenum = (0, _jquery321Min2.default)(ele).parents(\"li\").find(\".votenum\").text();\n            (0, _jquery321Min2.default)(ele).parents(\"li\").find(\".votenum\").text(votenum - 0 + 1);\n            (0, _jquery321Min2.default)(ele).text(\"已投票\").addClass(\"inactive\").prop(\"disabled\", true);\n          } else if (res.state == -1) {\n            toast.tips(res.msg);\n          }\n        },\n        error: function (err) {\n          toast.tips('网络不顺畅，请稍后再试');\n        }\n      });\n    }\n  });\n});"},"hash":"8610583d5cb542d593f825e016ce0177"}