{"dependencies":[{"name":"./jquery-3.2.1.min.js","loc":{"line":1,"column":14}},{"name":"../../js/servers.js","loc":{"line":2,"column":20}},{"name":"./main.js","loc":{"line":3,"column":49}},{"name":"../css/invite.css","loc":{"line":4,"column":16}},{"name":"../toast/toast.js","loc":{"line":5,"column":18}},{"name":"../toast/toast.css","loc":{"line":6,"column":21}},{"name":"./md5.min.js","loc":{"line":7,"column":16}},{"name":"./TymClientLock.min.js","loc":{"line":8,"column":17}}],"generated":{"js":"\"use strict\";\n\nvar _jquery321Min = require(\"./jquery-3.2.1.min.js\");\n\nvar _jquery321Min2 = _interopRequireDefault(_jquery321Min);\n\nvar _servers = require(\"../../js/servers.js\");\n\nvar _servers2 = _interopRequireDefault(_servers);\n\nvar _main = require(\"./main.js\");\n\nvar _invite = require(\"../css/invite.css\");\n\nvar _invite2 = _interopRequireDefault(_invite);\n\nvar _toast = require(\"../toast/toast.js\");\n\nvar _toast2 = _interopRequireDefault(_toast);\n\nvar _toast3 = require(\"../toast/toast.css\");\n\nvar _toast4 = _interopRequireDefault(_toast3);\n\nvar _md5Min = require(\"./md5.min.js\");\n\nvar _md5Min2 = _interopRequireDefault(_md5Min);\n\nvar _TymClientLockMin = require(\"./TymClientLock.min.js\");\n\nvar _TymClientLockMin2 = _interopRequireDefault(_TymClientLockMin);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\n// // 获取url参数\n// getQueryString = function(name) {\n//     var reg = new RegExp(\"(^|&)\" + name + \"=([^&]*)(&|$)\", \"i\");\n//     var r = window.location.search.substr(1).match(reg);\n//     if (r != null)\n//         return decodeURI(r[2]);\n//     return null;\n// }\n// //写cookies\n// function setCookie(name, value) {\n//     var Days = 30;\n//     var exp = new Date();\n//     exp.setTime(exp.getTime() + Days * 24 * 60 * 60 * 1000);\n//     document.cookie = name + \"=\" + escape(value) + \";expires=\" + exp.toGMTString();\n// }\n// //读取cookies\n// function getCookie(name) {\n//     var arr, reg = new RegExp(\"(^| )\" + name + \"=([^;]*)(;|$)\");\n//     if (arr = document.cookie.match(reg))\n//         return unescape(arr[2]);\n//     else\n//         return null;\n// }\nvar userid = (0, _main.getQueryString)(\"id\");\nvar host = \"192.168.168.69:3314\";\nvar reghost = \"192.168.168.52:8080\";\n// var reghost = \"appbs.tymshop.com:8080\";\nvar lrefereeId = (0, _main.getQueryString)(\"lrefereeId\");\nvar refuserid = (0, _main.getQueryString)(\"refuserid\");\nvar specId = (0, _main.getQueryString)(\"specId\"); //规格id\nvar url_param = window.location.search;\n//    控制字体大小\n(function (doc, win) {\n  var docEl = doc.documentElement,\n      retime,\n      resizeEvt = 'orientationchange' in window ? 'orientationchange' : 'resize',\n      recalc = function () {\n    var clientWidth = docEl.clientWidth;\n    if (!clientWidth) return;\n    docEl.style.fontSize = 100 * (clientWidth / 375) + 'px';\n  };\n  // Abort if browser does not support addEventListener\n  if (!doc.addEventListener) return;\n  win.addEventListener(resizeEvt, recalc, false);\n  doc.addEventListener('DOMContentLoaded', recalc, false);\n})(document, window);\n(0, _jquery321Min2.default)(function () {\n  // $(\"#head\").attr(\"src\",getQueryString(\"headimg\"));\n  // $(\"#title\").text(getQueryString(\"name\"));\n  var isClicked = false; //是否已点击获取验证码\n\n  //获取绑定窗口手机号\n  function GetBindPhone(text) {\n    var phone = text.replace(/\\s/g, \"\");\n    if (phone == '') {\n      _toast2.default.tips('请输入你的手机号码');\n      return null;\n    }\n    var phoneRegular = /^1\\d{10}$/; //手机号正则\n    if (!phoneRegular.test(phone)) {\n      _toast2.default.tips(\"请输入正确的手机号码！\");\n      return null;\n    }\n    return phone;\n  }\n  // 解决 安卓弹起输入法时底部的固定栏弹起\n  var h = document.body.scrollHeight;\n  window.onresize = function () {\n    if (document.body.scrollHeight < h) {\n      (0, _jquery321Min2.default)(\".bottom\").hide();\n    } else {\n      (0, _jquery321Min2.default)(\".bottom\").show();\n    }\n  };\n  //获取绑定窗口验证码\n  function GetBindCode() {\n    var verCode = (0, _jquery321Min2.default)('#verCode').val();\n    if (verCode == '') {\n      _toast2.default.tips('请输入你的验证码');\n      (0, _jquery321Min2.default)('#verCode').focus();\n      return null;\n    }\n    return verCode;\n  }\n\n  //获取图形验证码\n  function GetBindImgCode() {\n    var verCode = (0, _jquery321Min2.default)('#imgCodeString').val();\n    if (verCode == '') {\n      _toast2.default.tips('请输入你的验证码');\n      (0, _jquery321Min2.default)('#imgCodeString').focus();\n      return null;\n    }\n    return verCode;\n  }\n\n  function ImgCodeDialog(isShow) {\n    // $(\"#showPhone\").css('display', isShow?'none':'block');\n    // $(\"#publichttp\").css('display', isShow ? 'none' : 'block');\n    // $(\"#get\").css('display', isShow ? 'none' : 'block');\n    (0, _jquery321Min2.default)(\"#imgCodeDialog\").css('display', isShow ? 'block' : 'none');\n    if (isShow) {\n      (0, _jquery321Min2.default)(\"#imgCodeString\").val(\"\");\n      var phone = GetBindPhone((0, _jquery321Min2.default)(\"#phone\").val());\n      if (phone == null) {\n        return;\n      }\n      (0, _jquery321Min2.default)(\"#imgCode\").attr(\"src\", \"http://appbs.tymshop.com:8080/appbs/newUserService/getImage/\" + phone + \"?timestamp=\" + Date.parse(new Date()));\n    }\n  }\n  (0, _jquery321Min2.default)(\".labelbox\").on(\"click\", function (e) {\n    e.preventDefault();\n  });\n  //获取验证码\n  (0, _jquery321Min2.default)('#getCode').on(\"click\", function (e) {\n    var evt = e || event;\n    e.stopPropagation();\n    e.preventDefault();\n\n    (0, _jquery321Min2.default)(\"#imgCodeString\").focus();\n    //电话号码\n    var phone = GetBindPhone((0, _jquery321Min2.default)(\"#phone\").val());\n    if (phone == null) {\n      return;\n    }\n    // console.log(isClicked);   // 关闭时 \n    if (!isClicked) {\n      //显示图形验证码\n      ImgCodeDialog(true);\n    }\n  });\n  var timer = null;\n  (0, _jquery321Min2.default)('#okImgCode').click(function () {\n    if (!isClicked) {\n      var sImgCode = GetBindImgCode();\n      if (!sImgCode) {\n        return;\n      }\n      _toast2.default.loading(); //等待转圈\n      //发送服务请求 -- 获取验证码 \n      var newphone = GetBindPhone((0, _jquery321Min2.default)(\"#phone\").val());\n      _jquery321Min2.default.ajax({\n        url: \"http://\" + reghost + \"/appbs/newUserService/checkCode\",\n        type: \"post\",\n        data: {\n          phone: newphone,\n          code: sImgCode\n        },\n        success: function (result) {\n          if (result.state == 0) {\n            //正常\n            isClicked = true;\n            _toast2.default.result('验证码已发送！');\n            if ((0, _jquery321Min2.default)('#getCode').text() == '获取验证码') {\n              var second = 60;\n              (0, _jquery321Min2.default)('#getCode').attr(\"disabled\", false);\n              (0, _jquery321Min2.default)('#getCode').css({ 'background-color': '#f0f0f0' });\n              timer = setInterval(function () {\n                second -= 1;\n                if (second >= 0) {\n                  (0, _jquery321Min2.default)('#getCode').html(\"还剩 \" + second + \" 秒\");\n                } else {\n                  clearInterval(timer);\n                  (0, _jquery321Min2.default)('#getCode').html('获取验证码');\n                  (0, _jquery321Min2.default)('#getCode').css({ 'background-color': '#D75142' });\n                  isClicked = false;\n                }\n              }, 1000);\n              _toast2.default.remove();\n            }\n          } else {\n            //异常\n            _toast2.default.tips(result.result);\n            (0, _jquery321Min2.default)('#dialog_code').val(\"\");\n            _toast2.default.remove();\n          }\n        },\n        error: function () {\n          _toast2.default.tips(\"网络异常\");\n          _toast2.default.remove();\n        }\n      });\n      ImgCodeDialog(false);\n    }\n  });\n  (0, _jquery321Min2.default)(\"#imgCodeDialog .closedialog\").on(\"click\", function () {\n    clearInterval(timer);\n    isClicked = false;\n    (0, _jquery321Min2.default)(\"#imgCodeDialog\").hide();\n    // $(\"#phone\").val(\"\");//清空手机号码的值\n    (0, _jquery321Min2.default)(\"#verCode\").val(\"\"); // 清空验证码的值\n    ImgCodeDialog(false);\n    (0, _jquery321Min2.default)(\"#getCode\").html(\"获取验证码\").removeAttr(\"disabled\").css(\"background-color\", \" #D75142\");\n  });\n  (0, _jquery321Min2.default)('#imgCodeReset').click(function () {\n    ImgCodeDialog(true);\n  });\n\n  // 立即注册\n  (0, _jquery321Min2.default)(\"#regBtn\").on(\"click\", function () {\n    var phone = (0, _jquery321Min2.default)('#phone').val();\n    var checkcode = (0, _jquery321Min2.default)(\"#imgcode\").val();\n    var password = 888888;\n    var phoneRegular = /^1\\d{10}$/; //手机号正则\n\n    if (phone == '') {\n      _toast2.default.tips('请输入你的手机号码');\n      (0, _jquery321Min2.default)('#phone').focus();\n      return;\n    }\n    if (!phoneRegular.test(phone)) {\n      _toast2.default.tips(\"请输入正确的手机号码！\");\n      (0, _jquery321Min2.default)('#phone').focus();\n      return;\n    }\n    if (checkcode == '') {\n      _toast2.default.tips('请输入验证码');\n      (0, _jquery321Min2.default)('#imgcode').focus();\n      return;\n    }\n\n    // password = $.md5(\"T\" + password);\n    password = (0, _md5Min2.default)(\"T\" + password);\n    var getIrefereeId = (0, _main.getQueryString)(\"lrefereeId\"); // 获取url推荐人参数\n    var refuserid = (0, _main.getQueryString)(\"refuserid\"); // 获取refuserid参数\n    var bargain = (0, _main.getQueryString)('bargain'); //获取砍价参数\n    if (bargain == null) {\n      bargain = \"\";\n    }\n    if (getIrefereeId == null) {\n      getIrefereeId = \"100012\";\n    }\n    if (refuserid == null) {\n      refuserid = \"\";\n    }\n\n    var data = {\n      phone: phone,\n      code: checkcode,\n      password: password,\n      platformID: getIrefereeId,\n      refuserid: refuserid,\n      specId: specId || \"\"\n    };\n\n    var param = (0, _TymClientLockMin2.default)('#*06#', JSON.stringify(data), 4);\n\n    _toast2.default.loading();\n\n    //发送服务请求：--用户注册\n    _jquery321Min2.default.ajax({\n      url: \"http://\" + reghost + \"/appbs/newUserService/register\",\n      type: \"post\",\n      data: { sCondition: param },\n      success: function (data) {\n        console.log(data);\n        if (data.state == 0 || data.state == 2) {\n          clearInterval(timer);\n          (0, _jquery321Min2.default)('#getCode').text('获取验证码');\n          _toast2.default.result('注册成功！');\n          if (data.userId) {\n            window.location.href = \"/appbs/vote/index.html\" + url_param + \"&id=\" + data.userId;\n          }\n        } else if (data.state == 1) {\n          _toast2.default.result('注册异常');\n        } else if (data.state == -3) {\n          _toast2.default.result('用户已存在！');\n        } else if (data.state == -8) {\n          _toast2.default.result('验证码错误！');\n        } else if (data.state == -9) {\n          _toast2.default.result('您已注册！');\n          window.location.href = \"/appbs/vote/index.html\" + url_param + \"&id=\" + data.userId;\n        } else if (data.state == -101) {\n          _toast2.default.result('平台号不存在！');\n        } else if (data.state == -100) {\n          _toast2.default.result('推广人不存在！');\n        } else {\n          _toast2.default.result(data.result);\n        }\n        _toast2.default.remove();\n      },\n      error: function (err) {\n        _toast2.default.result(\"网络异常\");\n        _toast2.default.remove();\n      }\n    });\n  });\n  (0, _jquery321Min2.default)(\".delad\").on(\"click\", function () {\n    (0, _jquery321Min2.default)(\".bottom\").remove();\n  });\n});"},"hash":"37914f2caf70bc0fb33c8be8d6655757"}