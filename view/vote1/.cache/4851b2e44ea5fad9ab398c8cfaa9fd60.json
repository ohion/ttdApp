{"dependencies":[],"generated":{"js":"function getQueryString(name) {\r\n    var reg = new RegExp(\"(^|&)\" + name + \"=([^&]*)(&|$)\", \"i\");\r\n    var r = window.location.search.substr(1).match(reg);\r\n    if (r != null)\r\n        return unescape(r[2]);\r\n    return null;\r\n}\r\n//写cookies\r\nfunction setCookie(name, value) {\r\n    var Days = 30;\r\n    var exp = new Date();\r\n    exp.setTime(exp.getTime() + Days * 24 * 60 * 60 * 1000);\r\n    document.cookie = name + \"=\" + escape(value) + \";expires=\" + exp.toGMTString();\r\n}\r\n//读取cookies\r\nfunction getCookie(name) {\r\n    var arr, reg = new RegExp(\"(^| )\" + name + \"=([^;]*)(;|$)\");\r\n    if (arr = document.cookie.match(reg))\r\n        return unescape(arr[2]);\r\n    else\r\n        return null;\r\n}\r\n\r\n// 获取url参数\r\nvar sOpenId = getQueryString(\"sOpenId\");\r\nvar ua = navigator.userAgent.toLowerCase();//获取判断用的对象\r\nif (ua.match(/MicroMessenger/i) == \"micromessenger\") {  //微信  u授权\r\n    sOpenId = getQueryString(\"sOpenId\"); // 获取url sOpenId 参数\r\n    sAccessToken = getQueryString(\"sAccessToken\"); // 获取url sAccessToken 参数\r\n}\r\nvar userid = getQueryString(\"id\");\r\nvar lrefereeId = getQueryString(\"lrefereeId\");\r\nvar refuserid = getQueryString(\"refuserid\");\r\nvar url_param = window.location.search;\r\n//    控制字体大小\r\n(function (doc, win) {\r\n    var docEl = doc.documentElement,retime,\r\n        resizeEvt = 'orientationchange' in window ? 'orientationchange' : 'resize',\r\n        recalc = function () {\r\n            var clientWidth = docEl.clientWidth;\r\n            if (!clientWidth) return;\r\n            docEl.style.fontSize = 100 * (clientWidth / 375) + 'px';\r\n        };\r\n    // Abort if browser does not support addEventListener\r\n    if (!doc.addEventListener) return;\r\n    win.addEventListener(resizeEvt, recalc, false);\r\n    doc.addEventListener('DOMContentLoaded', recalc, false);\r\n})(document, window);\r\n$(function(){\r\n\t// 获取列表\r\n// 投票\r\n\tvar host = servers.voteService;\r\n\tvar page = 1;\r\n\trender(page);\r\n\tfunction render(page){\r\n\t\tvar voteobj = {\r\n\t\t\tuserId: userid?userid:0,\r\n\t\t\tpage:page\r\n\t\t}\r\n\t\t$.ajax({\r\n\t\t\turl:\"http://\"+host+\"/vote/queryAssociation\",\r\n\t\t\ttype:\"post\",\r\n\t\t\tdata:voteobj,\r\n\t\t\tsuccess:function(res){\r\n\t\t\t\tres = JSON.parse(res);\r\n\t\t\t\tif(res.state == 0){\r\n\t\t\t\t\t$(\"#head\").attr(\"src\",res.result.photoUrl);\r\n\t\t\t\t\tres.result.page = page;\r\n\t\t\t\t\tvar tpl = document.getElementById('tpl').innerHTML;\r\n\t\t\t\t\tvar newDom = document.createElement(\"div\");\r\n\t\t\t\t\tnewDom.innerHTML = template(tpl, {result: res.result});\r\n\t\t\t\t\tdocument.getElementById('content').appendChild(newDom);\r\n\t\t\t\t\tif(res.result.list.length == 0){\r\n\t\t\t\t\t\t$(window).unbind('scroll', getmore);//解绑scroll事件\r\n\t\t\t\t\t\t$(\".tip\").text(\"到底咯\");\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\terror:function(err){\r\n\t\t\t\ttoast.tips('网络不顺畅，请稍后再试');\r\n\r\n\t\t\t}\r\n\t\t})\r\n\t}\r\n\t\r\n\t//下拉加载更多\r\n\t// window.addEventListener(\"scroll\",getmore);\r\n\t $(window).scroll(getmore);\r\n\tfunction getmore(){\r\n\t\tvar oscroll = $(document).scrollTop()+$(window).height();\r\n\t\tif(oscroll>$(\"#content\").height()+150){\r\n\t\t\trender(++page);\r\n\t\t}\r\n\t}\r\n\t\r\n\r\n\t$(\"#content\").on(\"click\",\".vote\",function(){\r\n\t\tvar id = $(this).data(\"id\");\r\n\t\tvar ele = $(this);\r\n\t\t// 跳到注册界面\r\n\t\tif(!userid){\r\n\t\t\twindow.location.href = \"http://\"+servers.shopServer+\"/appbs/vote/invite.html\"+url_param;\r\n\t\t}else{\r\n\t\t\tvar obj = {\r\n\t\t\t\tuserId: userid,\r\n\t\t\t\tid: id\r\n\t\t\t}\r\n\t\t\t// 投票\r\n\t\t\t$.ajax({\r\n\t\t\t\turl:\"http://\"+host+\"/vote/userVote\",\r\n\t\t\t\ttype:\"post\",\r\n\t\t\t\tdata:obj,\r\n\t\t\t\tsuccess:function(res){\r\n\t\t\t\t\tres = JSON.parse(res);\r\n\t\t\t\t\tif(res.state ==0){\r\n\t\t\t\t\t\ttoast.tips('投票成功');\r\n\t\t\t\t\t    //票数+1   按钮不可点击\r\n\t\t\t\t\t    var votenum = $(ele).parents(\"li\").find(\".votenum\").text();\r\n\t\t\t\t\t    $(ele).parents(\"li\").find(\".votenum\").text(votenum-0+1);\r\n\t\t\t\t\t    $(ele).text(\"已投票\").addClass(\"inactive\").prop(\"disabled\",true);\r\n\t\t\t\t\t}else if(res.state == -1){\r\n\t\t\t\t\t\ttoast.tips(res.msg);\r\n\t\t\t\t\t}\r\n\t\t\t\t},\r\n\t\t\t\terror:function(err){\r\n\t\t\t\t\ttoast.tips('网络不顺畅，请稍后再试');\r\n\r\n\t\t\t\t}\r\n\t\t\t})\r\n\t\t}\r\n\t})\r\n})"},"hash":"a4e7c66ebd01ea659a8340604940ae9a"}